<!DOCTYPE html>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-38176147-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-38176147-3');
  </script>

  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Image Similarity Tool</title>
  <link rel="shortcut icon" href="static/favicon.ico">
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->
  <link href="static/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/node_modules/bootstrap-colorpicker/dist/css/bootstrap-colorpicker.css" rel="stylesheet">
  <link rel="stylesheet" href="./static/css/app.css">
  <script src="./node_modules/bootstrap-select/dist/css/bootstrap-select.min.css"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
  <!-- (Optional) Latest compiled and minified JavaScript translation files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/i18n/defaults-*.min.js"></script>

  <script src="https://unpkg.com/scrollreveal/dist/scrollreveal.min.js"></script>

  <script>


  function magnify(imgID, topFile, zoom) {
  var img, glass, w, h, bw, top;

  img = document.getElementById(imgID);
  top = document.getElementById(topFile);
  /*create magnifier glass:*/
  glass = document.createElement("DIV");
  glass.setAttribute("class", "img-magnifier-glass");

  /*insert magnifier glass:*/
  img.parentElement.insertBefore(glass, img);

  /*set background properties for the magnifier glass:*/
  glass.style.backgroundImage = "url('" + img.src + "')";
  glass.style.backgroundRepeat = "no-repeat";
  glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
  bw = 3;
  w = glass.offsetWidth / 3;
  h = glass.offsetHeight / 3;

  /*execute a function when someone moves the magnifier glass over the image:*/
  glass.addEventListener("mousemove", moveMagnifier);
  top.addEventListener("mousemove", moveMagnifier);

  /*and also for touch screens:*/
  glass.addEventListener("touchmove", moveMagnifier);
  top.addEventListener("touchmove", moveMagnifier);
  function moveMagnifier(e) {
    var pos, x, y;
    /*prevent any other actions that may occur when moving over the image*/
    e.preventDefault();
    /*get the cursor's x and y positions:*/
    pos = getCursorPos(e);
    x = pos.x;
    y = pos.y;
    /*prevent the magnifier glass from being positioned outside the image:*/
    if (x > img.width - (w / zoom)) {x = img.width - (w / zoom);}
    if (x < w / zoom) {x = w / zoom;}
    if (y > img.height - (h / zoom)) {y = img.height - (h / zoom);}
    if (y < h / zoom) {y = h / zoom;}
    /*set the position of the magnifier glass:*/
    glass.style.left = (x - w) + "px";
    glass.style.top = (y - h) + "px";
    /*display what the magnifier glass "sees":*/
    glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
  }

  function getCursorPos(e) {
    var a, x = 0, y = 0;
    e = e || window.event;
    /*get the x and y positions of the image:*/
    a = img.getBoundingClientRect();
    /*calculate the cursor's x and y coordinates, relative to the image:*/
    x = e.pageX - a.left;
    y = e.pageY - a.top;
    /*consider any page scrolling:*/
    x = x - window.pageXOffset;
    y = y - window.pageYOffset;
    return {x : x, y : y};
  }
}
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })

    $(function () {
     $('#cp').colorpicker();
   });


    // Smooth scrolling when clicking href links
    $(document).on('click', 'a[href^="#"]', function (event) {
        event.preventDefault();

        $('html, body').animate({
            scrollTop: $($.attr(this, 'href')).offset().top
        }, 500);
    });

    // On page load
    $(document).ready(function() { 

      // Reveal example result when user scrolls to it
      window.sr = ScrollReveal();
      function animateExampleResult( element ){
        document.getElementById("xaxis-line").style.webkitAnimationPlayState = "running";
        document.getElementById("yaxis-line").style.webkitAnimationPlayState = "running";
      }
      sr.reveal('#example-result', { duration: 2000, afterReveal: animateExampleResult});

      // Highlight first step
      document.getElementById("fileinput").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      elem = document.getElementById("instruction_step1");
      if (elem) {
        elem.style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      }

      // Enable magnifier glass (after it loads)
      $("#tsne_plot").on('load', function() {
          magnify("tsne_plot", "circles", 3);
      }).each(function() {
         if($(this).prop('complete')) $(this).load();
      });

    });

    function setVisible_step1(){
      document.getElementById("fileinput").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("step2").style.border = "1px solid #ccc";
      document.getElementById("step3").style.border = "2px dashed #337ab7";
      document.getElementById("step4").style.border = "2px dashed #f4f9fa";
      document.getElementById("generate_button").style.border = "2px dashed #5cb85c";

      document.getElementById("instruction_step1").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("instruction_step2").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step3").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step4").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step5").style.border = "2px dashed rgba(0,0,0,0)";
    }
    function setVisible_step2(){
      document.getElementById("fileinput").style.border = "2px dashed #f4f9fa";
      document.getElementById("step2").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("step3").style.border = "2px dashed #337ab7";
      document.getElementById("step4").style.border = "2px dashed #f4f9fa";
      document.getElementById("generate_button").style.border = "2px dashed #5cb85c";

      document.getElementById("instruction_step1").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step2").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("instruction_step3").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step4").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step5").style.border = "2px dashed rgba(0,0,0,0)";
    }
    function setVisible_step3(){
      document.getElementById("fileinput").style.border = "2px dashed #f4f9fa";
      document.getElementById("step2").style.border = "1px solid #ccc";
      document.getElementById("step3").style.border = "2px dashed black";
      document.getElementById("step4").style.border = "2px dashed #f4f9fa";
      document.getElementById("generate_button").style.border = "2px dashed #5cb85c";

      document.getElementById("instruction_step1").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step2").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step3").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("instruction_step4").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step5").style.border = "2px dashed rgba(0,0,0,0)";
    }
    function setVisible_step4(){
      document.getElementById("fileinput").style.border = "2px dashed #f4f9fa";
      document.getElementById("step2").style.border = "1px solid #ccc";
      document.getElementById("step3").style.border = "2px dashed #337ab7";
      document.getElementById("step4").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("generate_button").style.border = "2px dashed #5cb85c";

      document.getElementById("instruction_step1").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step2").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step3").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step4").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
      document.getElementById("instruction_step5").style.border = "2px dashed rgba(0,0,0,0)";
    }
    function setVisible_step5(){
      document.getElementById("fileinput").style.border = "2px dashed #f4f9fa";
      document.getElementById("step2").style.border = "1px solid #ccc";
      document.getElementById("step3").style.border = "2px dashed #337ab7";
      document.getElementById("step4").style.border = "2px dashed #f4f9fa";
      document.getElementById("generate_button").style.border = "2px dashed #000";

      document.getElementById("instruction_step1").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step2").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step3").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step4").style.border = "2px dashed rgba(0,0,0,0)";
      document.getElementById("instruction_step5").style.border = "2px dashed rgb(46, 117, 145, 0.3)";
    }

    function generateTSNE() {
    // do ajax request to ask for what the location of the TSNE image is. Then use in in the following line.
    console.log('button pressed')
    httpGetAsync('/test',handleTSNEResponse)
  }
  function httpGetAsync(theUrl, callback)
  {
    console.log('async 1')
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
      if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
        callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
    console.log('async 2')
  }
  function handleTSNEResponse(responseText) {
    console.log('async callback')
    console.log(responseText)
    document.getElementById("tsne_plot").src = responseText
    console.log('done')
  }
  function setVisible() {
    elem = document.getElementById("instruction");
    if (elem != null) {
      elem.remove();
    }
    elem = document.getElementById("the_result_plot");
    if (elem != null) {
      elem.remove();
    }
    document.getElementById("loader").style.visibility = "visible";
  }
  function tweet_checkbox(){
    $('#modalTweet').modal('show');
  }
  function checkFolder() {
    console.log('hi')

    alert("hi");
      // if(document.getElementById("image").files.length == 0 ){
        if(document.getElementById("input-images")=== null ){

          console.log("no files selected");
          alert("no files selected");
        }
      }
      function sanityCheckInputFiles() {
    // Get files that user selected
    input = document.getElementById('fileinput');
    files = input.files;


    // Check if size of files exceed limit
    // console.log('input.files[0]: ', input.files[0], files[0].size);
    for (i = 0; i < files.length; i++) { 
      if (files[i].size>3*1024*1024) { // this is 3 MiB
        $('#modalImageTooBig').modal('show');
      }
    }


    // Check if number of files exceed limit
    num_image_limit = 60;
    existing_images = document.getElementsByClassName('input-image');
    num_existing_images = existing_images.length;
    if (num_existing_images + files.length > num_image_limit){
      input.value = '';
      $('#modalTooManyImages').modal('show');
    }


    // Check if number of files doesn't reach limit
    num_image_min = 3;
    // existing_images = document.getElementsByClassName('input-image');
    // num_existing_images = existing_images.length;
    if ((num_existing_images + files.length)>0 && (num_existing_images + files.length) < num_image_min){
      input.value = '';
      $('#modalTooFewImages').modal('show');
    }


  }

  function ModelSelectChange() {
    model_name_elem = document.getElementById('model_name');
    model_name = model_name_elem.value;

    if (model_name == 'ResNet V2 101') {
      model_layer = 'Pool 5 (Last Hidden Layer)';
      num_features = '2048';
    } else if (model_name == 'VGG 16') {
      model_layer = 'Fully Connected 7 (Last Hidden Layer)';
      num_features = '4096';
    } else if (model_name == 'None') {
      model_layer = 'None';
      num_features = '40,000 pixels (input resized to 200x200)';
    }

    document.getElementById('model_layer').value = model_layer;
    document.getElementById('num_features').value = num_features;
  }

</script>

</head>



<body>

  <!-- Modal for exceeding maximum number of images-->
  <div class="modal fade" id="modalTooManyImages" tabindex="-1" role="dialog" aria-labelledby="modalTooManyImagesLabel">
    <div class="modal-dialog" role="document" style="color:#333">
      <div class="modal-content">
        <div class="modal-header alert alert-danger">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="modalTooManyImagesLabel">Too Many Image Files</h4>
        </div>
        <div class="modal-body">
          <p>Sorry, you have exeeded the maximum number of images that can be uploaded which is 60. The images that you have selected have been ignored.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal">Ok</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for not reaching minumum number of image-->
  <div class="modal fade" id="modalTooFewImages" tabindex="-1" role="dialog" aria-labelledby="modalTooFewImagesLabel">
    <div class="modal-dialog" role="document" style="color:#333">
      <div class="modal-content">
        <div class="modal-header alert alert-danger">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="modalTooFewImagesLabel">Too Few Image Files</h4>
        </div>
        <div class="modal-body">
          <p>Sorry, you have not uploaded the minimum number of images that can be uploaded, which is 3. The images that you have selected have been ignored.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal">Ok</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for exceeding max image size -->
  <div class="modal fade" id="modalImageTooBig" tabindex="-1" role="dialog" aria-labelledby="modalImageTooBigLabel">
    <div class="modal-dialog" role="document" style="color:#333">
      <div class="modal-content">
        <div class="modal-header alert alert-danger">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="modalImageTooBigLabel">Image size too big</h4>
        </div>
        <div class="modal-body">
          <p>Sorry, you have exeeded the maximum size of images that can be uploaded which is 3MB. The images that you have selected have been ignored.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal">Ok</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal for the not working tweet function!-->
  <div class="modal fade" id="modalTweet" tabindex="-1" role="dialog" aria-labelledby="modalTweetLabel">
    <div class="modal-dialog" role="document" style=" color:#000000;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="modalFewManyImagesLabel">Sorry! This feature is not yet implemented</h4>
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal">Ok</button>
        </div>
      </div>


    </div>
  </div>



<!-- Header -->

  <div class="row" > 
    <div class="col-md-12" style=" padding-right: 0px;" >

      <!-- Links at top of page -->
      <div class="topbar" >
        <a class="topbar-link" href="mailto:danielsnider12@gmail.com; bessaFan01@gmail.com" target="_blank">Contact</a>
        <a class="topbar-link" href="https://github.com/bessaFan/ML-playground" target="_blank" >Documentation</a>
        <a class="topbar-link" onclick="tweet_checkbox()">Support Us</a>
      </div>
      <div style="position: absolute; right: 30px; top: 10px">
        
        <div style="">
          <a href="https://github.com/bessaFan/ML-playground" target="_blank">
            <img style="opacity: 0.7; width:50px; filter: invert(100%);" src="/static/images/github_icon.svg">
          </a>
        </div>
      </div>

      <!-- <div class=container> -->
        <div class="header" style="height: 100%; padding: 150px 100px 40px 100px;">
          <div class="header-title">
            Deep Learning<br>Image Similarity<br>Web Tool
          </div>
          <div>
            <!-- <img src="/static/images/cell-tsne-transparent.png" style="height:500px; padding-top:50px; filter: invert(100%)"> -->
          </div>
          <div class="header-subtitle" style="padding-top: 50px">
            <!-- No install. No code. Instant Visualization.  -->
            <!-- Use our web tool to experiment with popular ML models and visualization techniques designed to expose similarities, trends, differences, and outliers in your image set. Built at the SickKids Research Institute for cell biology research. -->
            Our web app provides a "No code—No installation" platform for you to upload images and compare popular machine learning models and manifold learning algorithms. Pick from the options and we'll generate a 2D plot where similar images are placed close together and dissimilar images are far apart. Find similarities, trends, differences, and outliers in your image set. While this is not a classification tool, you can apply colored labels to indiviual images at the time of uploading. Lastly, you can download feature vectors to CSV and do your own analysis.
            <!-- Our web app provides a "No code. No installation" platform for researchers to upload images and compare clustering results with popular machine learning models and manifold learning algorithms, making experimenting and prototyping with ML less time-consuming. There’s currently no existing app that allows fast organization and visualization of data -->
          </div>
          <a href="#try" >
            <button class="btn btn-default" id="try-btn">TRY NOW</button>
          </a>
          <br>
            <div class="example-result" id="example-result" style="visibility: hidden; position: relative; width: 100%; margin-left: auto; margin-right: auto;">
              <!-- <img src="/static/images/cell-tsne.png" style="position: absolute; top: 0px; right: 0px; width:100%;"> -->
              <img src="/static/images/cell-tsne2.png" style="position: relative; top: 0px; right: 0px; width:100%;">

              <svg style='position:absolute; top: 0; right: 0; position:absolute; top: 0; right: 0; height:100%; width:100%; overflow: visible;' version="1.1" xmlns="http://www.w3.org/2000/svg">
                <line id="xaxis-line" stroke-dasharray="200%" stroke-dashoffset="200%"   x1="10%" y1="90%" x2="90%" y2="90%" />
                <line id="yaxis-line" stroke-dasharray="200%" stroke-dashoffset="200%"   x1="10%" y1="90%" x2="10%" y2="10%" />
                <text x="91%" y="91.5%" font-size="2em" fill="white" text-anchor="left">
                   t-SNE1
                 </text>
                <text x="10%" y="7%" font-size="2em" fill="white" text-anchor="middle">
                   t-SNE2
                 </text>
                <text x="10%" y="7%" font-size="2em" fill="white" text-anchor="middle">
                   t-SNE2
                 </text>
                 <rect x="11%" y="81.3%" width="1.5%" height="3%" style="fill:#066fd5;stroke-width:0" />
                <text x="13.5%" y="83.7%" font-size="1em" fill="white" text-anchor="left">
                   Cervical Cancer (SiHa cells)
                 </text>
                 <rect x="11%" y="85.3%" width="1.5%" height="3%" style="fill:#ff0000;stroke-width:0" />
                <text x="13.5%" y="87.7%" font-size="1em" fill="white" text-anchor="left">
                   Li–Fraumeni Cancer Predisposition Syndrome (Fibroblast cells)
                 </text>
              </svg>
                
            <!-- <img src="/static/images/spindly.png" style="position: absolute; top: 20px; right: 20px; width:30%;">
            <img src="/static/images/foci.png" style="position: absolute; top: 30px; right: 30px; width:30%;">
            <img src="/static/images/round.png" style="position: absolute; top: 40px; right: 40px; width:30%;">
             -->  

              <style>
              #xaxis-line{
                  stroke: white;
                  stroke-width: 2;
                  animation: offset 6s ease forwards;
                  /*animation-delay: 2s;*/
                  animation-play-state: paused;
              }
              #yaxis-line{
                  stroke: white;
                  stroke-width: 2;
                  animation: offset 10s ease forwards;
                  /*animation-delay: 2s;*/
                  animation-play-state: paused;
              }

              @keyframes offset {
                to {
                  stroke-dashoffset: 0;
                }
              }
              </style>
              <!-- <img src="/static/images/cell-tsne2.png" style="position: absolute; top: 0px; right: 0px; width:100%;"> -->
            </div>

        </div>
      <!-- </div> -->
    </div>
  </div>

<!-- Old Header -->
<!-- 
  <div class="row" > 
    <div class="header col-md-12" >
      <div class=container>
      <span class="header-text">
        Generate t-SNE Plots in the Browser
      </span>
      <span>
        <img src="static/images/dots.png" style="height:39px" class="header-img">
      </span>
        </div>
    </div>
  </div>
 -->

  <!-- Body -->
<!-- <div class="container" > -->
    <div class="row mydivider" style="height:3px; background-color: #1b9eb245;"></div>

    <div class="row equal" id="try">

      <!-- left side of the layout -->
      <div class="col-md-6 leftside" style="padding-left: 45px; padding-top: 20px">
<!--       {% if not image_exists %}
        <img class="arrow1-position" id="arrow1" src="static/images/picture4.png"> 
      {% else %}
        <img class="arrow2-position" id="arrow2" src="static/images/picture4.png"> 
      {% endif %}
    -->      <!-- upload images -->
    <h1>Upload Images</h1>
    <form method=post enctype=multipart/form-data class='form-horizontal' action='?session={{session_id}}#try'>
    <!-- <span id="helpBlock" class="help-block">Please upload 3 to 60 images for analysis. </span> -->

      <div class="form-group">
        <label class="col-sm-4 control-label">Choose up to 60 images </label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="These images you select will be processed by our system and the result will be an image similarity visualization.">
        <div class="col-sm-6">
          <input id="fileinput" onchange="sanityCheckInputFiles()" type=file name=file accept="image/*" multiple style="border-radius: 10px; opacity: 0.7; padding: 3px">
        </div>
      </div> 

      <div class="form-group">
        <label class="col-sm-4 control-label">Color label for images</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Click on the colored square to choose a color. The color that you choose will be drawn around the image in the result plot.">
        <div class="col-sm-6">
          <!-- Select Label Color:  -->
          <div id="cp" class="input-group colorpicker-component" title="Using input value">
            <input id= "step2" name="hexcolor" type="text" class="form-control input " value="#196f90" style="height: 34px;font-size: 16px;" />
            <span class="input-group-addon" "><i></i></span>
          </div>
        </div>
      </div> 

      <div class="form-group">
        <div class="col-sm-offset-4 col-sm-3" >
          <input id="step3" type="submit" class="btn btn-primary" value="Upload" style="opacity: 0.7; border: 2px dashed  #337ab7; margin-top: 8px;margin-bottom: 4px">
        </div>
      </div>


      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Your Image Set</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Preview your images.">
        <div class="col-sm-6">
          {% if not colors %}
            <img class="zoomed" src="./static/images/placeholder-cat.png" style= "object-fit:cover; border:5px solid;" height="42" width="42"/>
          {% endif %}
          {% for color in colors %}
          <div>
            {% for image in color.images %}
            <span id="input-images">
               <img class="input-image zoomed" src="{{ image|thumbnail('100x100') }}" style= "object-fit:cover; border:5px solid #{{ color.hex }};margin-bottom: 4px; " height="42" width="42"/>
          
            </span>
            {% endfor %}
          </div>
          {% endfor %}
        </div>
      </div> 


    </form>



    <!-- parameters -->
    <form id="step4"  class="form-horizontal" action='/tsne' style="margin-top:15px; border-radius: 10px;" >

      <!-- Machine Learning Parameters -->
      <h3 style="padding-top: 15px; border-top: 1px solid rgba(18, 65, 69, .07);" >Feature Extraction</h3> 
      <span id="helpBlock" class="help-block">Choose a pre-trained machine learning model for feature extraction.</span>
      <div class="form-group">
        <label for="exampleDropdownForm" class="col-sm-4 control-label">Deep Learning Model</label>
        <select id="model_name" data-show-subtext="true" class="selectpicker show-tick col-xs-6" name="model_name" onchange="ModelSelectChange()">
          <option data-subtext="Passthrough pixels to feature reduction">None</option>
          <option >ResNet V2 101</option>   model_name
          <option selected >VGG 16</option>
          <option disabled>Inception V3</option>
          <option disabled>Inception V4</option>
          <option disabled>Inception-ResNet-v2</option>
          <option disabled>NASNet-A_Large_331</option>
          <option disabled>PNASNet-5_Large_331</option>
        </select>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Select the Machine Learning model here!">
      </div>

      <!-- Feature Extraction Layer -->
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Extract Features from Layer</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Which hidden layer of the deep learning model that image features are extracted from.">
        <div class="col-sm-6">
          <input disabled id="model_layer" class="form-control" name="model_layer" value="Pool 5 (Last Hidden Layer)" style="background-color: hsla(0, 0%, 97%, 1);">
        </div>
      </div> 

      <!-- Number of Input Features -->
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Number of Features</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="The number of features extracted from the image.">
        <div class="col-sm-6">
          <input readonly id="num_features" class="form-control" name="resolution" value="2048" style="background-color: hsla(0, 0%, 97%, 1);">
        </div>
      </div> 

      <h3 style="padding-top: 15px; border-top: 1px solid rgba(18, 65, 69, .07);" >Dimensionality Reduction</h3> 
      <span id="helpBlock" class="help-block" style="padding-right:16%">Choose a manifold learning algorithm to perform dimensionality reduction on the features extracted by the machine learning model. This will embed each image into two dimensional space so that it can be plotted. The dimensional reduction result is still representitive of the differences in the high dimenional feature space.</span>
      <div class="form-group">
        <label for="exampleDropdownForm" class="col-sm-4 control-label">Algorithm</label>
        <select class="selectpicker show-tick col-xs-6" name = "model_name">
          <option data-subtext="t-distributed Stochastic Neighbor Embedding">t-SNE</option>
          <option data-subtext="Local Tangent Space Alignment" disabled>LTSA</option>
          <option data-subtext="Modified Locally Linear Embedding" disabled>Modified LLE</option>
          <option data-subtext="Multi-dimensional Scalingdisabled" disabled>MDS</option>
          <option disabled>Isomap</option>
          <option disabled>Locally Linear Embedding</option>
          <option disabled>Spectral Embedding</option>
          <option disabled>Hessian Eigenmapping</option>
        </select>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Select the Manifold Learning model here!">
      </div> 

      <!-- tSNE Parameters form -->
      <h3 style="padding-top: 15px; border-top: 1px solid rgba(18, 65, 69, .07);">t-SNE Parameters</h3> 
      <span id="helpBlock" class="help-block">Settings that control the dimensionality reduction.</span>
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Perplexity</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="The perplexity is loosely how to balance attention between local and global aspects of your data. The parameter is, in a sense, a guess about the number of close neighbors each point has. The perplexity value has a complex effect on the resulting pictures. Consider selecting a value between 5 and 50.">
        <div class="col-sm-6">
          <input type="number" class="form-control"  name="perplexity" value="15" placeholder="perplexity">
        </div>
      </div>
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Early Exaggeration</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="Controls how tight natural clusters in the original space are in the embedded space and how much space will be between them. For larger values, the space between natural clusters will be larger in the embedded space. The choice of this parameter is not very critical.">
        <div class="col-sm-6">
          <input type="number" class="form-control"  name="early_exaggeration" value="12" placeholder="early_exaggeration">
        </div>
      </div>
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Learning Rate</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="The learning rate for t-SNE is usually in the range [10.0, 1000.0]. If the learning rate is too high, the data may look like a ‘ball’ with any point approximately equidistant from its nearest neighbours. If the learning rate is too low, most points may look compressed in a dense cloud with few outliers. If the cost function gets stuck in a bad local minimum increasing the learning rate may help.">
        <div class="col-sm-6">
          <input type="number" class="form-control"  name="learning_rate" value="200" placeholder="learning_rate">
        </div>
      </div>
      <h3 style="padding-top: 15px; border-top: 1px solid rgba(18, 65, 69, .07);">Plot Parameters</h3> 
      <span id="helpBlock" class="help-block">Settings that control quality and spacing of the visualization.</span>
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Dots Per Inchs</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="The resolution of the final plot. The bigger the value, the better the image quality. However, the plot generating speed increases as the resolution gets higher.">
        <div class="col-sm-6">
          <input type="number" class="form-control" name="DotsPerInchs" value="300" placeholder="DotsPerInchs">
        </div>
      </div>
      <div class="form-group">
        <label for="inputEmail3" class="col-sm-4 control-label">Canvas Size</label>
        <img src="static/images/tooltip.png" style="width:50px;height:38px;" class="btn btn-secondary invert" data-toggle="tooltip" data-placement="right" title="The smaller the canvas the more likely images will overlap. A larger canvas size will make images appear futher apart but also smaller.">
        <div class="col-sm-6">
          <input type="number" class="form-control"  name="CanvasSize" value="4000" placeholder="canvas size">
        </div>
      </div>
      <!-- set the loading icon visible when the "generate" tSNE button is pressed  -->
      <input type="hidden" name="session" value="{{session_id}}">
      <input type="hidden" name="colors" value="{{colors}}">
      <div class="form-group">
        <div class="col-sm-offset-4 col-sm-3" style="padding-bottom: 20px">
          {% if not image_exists %}
          <button type="submit" class="btn btn-success btn-lg" id= "generate_button" style="opacity: 0.7; border-width: 0px; z-index: 100;" onclick= "setVisible()" onclick= "checkFolder()" onclick="generateTSNE()" disabled>Generate Plot</button>
          {% else %}
          <button type="submit" class="btn btn-success btn-lg" id= "generate_button" style="opacity: 0.7; border-width: 0px; z-index: 100;" onclick= "setVisible()" onclick= "checkFolder()" onclick="generateTSNE() ">Generate Plot</button>
          {% endif %}
        </div>
      </div>
    </form>
  </div>


  <div class="col-md-6 rightside" style="padding-top: 20px">
    <svg class="svg-container" >
      <!-- the flower loading icon -->
      <symbol id="ei-spinner-icon" viewBox="0 0 50 50"><path d="M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z"></path><path opacity=".3" d="M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z"></path><path opacity=".3" d="M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z"></path><path opacity=".3" d="M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z"></path><path opacity=".93" d="M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z"></path><path opacity=".3" d="M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z"></path><path opacity=".65" d="M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z"></path><path opacity=".3" d="M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z"></path><path opacity=".86" d="M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z"></path><path opacity=".3" d="M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z"></path><path opacity=".44" d="M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z"></path><path opacity=".3" d="M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z"></path></symbol>
      <symbol id="flower-icon" viewBox="0 0 65 98" fill="none" fill-rule="evenodd" stroke="#fff" stroke-width="2"><path d="M0.0434880207,0.660889225 C0.0434880207,0.660889225 38.4349751,22.2085462 38.4349744,96.8228805" id="Path-142"></path><path d="M62.0915607,5.40798425 C62.0915607,5.40798425 36.9588366,-4.08164371 28.3460397,24.8902199 C57.7428081,31.9172508 62.0915607,5.40798425 62.0915607,5.40798425 Z" id="Imported-Layers"></path></symbol>
    </svg>



    <section >
      <section>

        <!-- Plot displaying -->
        {% if plot_exists %}
        <div class="image" id="the_result_plot">
          <h1>Result</h1>
          <div style="position: relative">
            <svg id="circles" height="1000" width="100%" style="position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%); opacity: .2;">
              <circle  cx="50%" cy="50%" r="350"  />
              <circle  cx="50%" cy="50%" r="270"  />
              <circle  cx="50%" cy="50%" r="200"  />
              <circle  cx="50%" cy="50%" r="140"  />
              <circle  cx="50%" cy="50%" r="90"  />
              <circle  cx="50%" cy="50%" r="50"  />
              <circle  cx="50%" cy="50%" r="20"  />
            </svg>  
            <img id="tsne_plot" src="{{plot_name}}?timestamp={{timestamp}}" style="width: 100%;"> 

            <!-- <img id="tsne_plot" src="static/output/{{session_id}}/ResultPlot_ModelName:{{model_name}}__Resolution:{{resolution}}_Perplexity:{{perplexity}}_EarlyExaggeration:{{early_exaggeration}}_LearningRate:{{learning_rate}}_DPI:{{DotsPerInchs}}.png" style="width: 100%;"> -->

            <!-- <img id="tsne_plot" src="static/output/{{session_id}}/ResultPlot_ModelName:{{model_name}}__Resolution:{{resolution}}_Perplexity:{{perplexity}}_EarlyExaggeration:{{early_exaggeration}}_LearningRate:{{learning_rate}}_DPI:{{DotsPerInchs}}.png?timestamp={{timestamp}}" style="width: 100%; max-height: 1000px; object-fit: contain; /*border: 4px solid gainsboro*/">  -->
          </div>

        </div>
        <!-- download image button and tweet result-->
        <div>
            <input type="checkbox" onclick="tweet_checkbox()" id="permission" name="subscribe" value="newsletter" style="opacity: 0.7;bottom: 130px;position: absolute;left: 34px;">
            <label for="permission" style="font-size: 17px;  left: 60px; bottom: 120px; position: absolute;" >Can we tweet your result? (for science!)</label>
        </div>
        {% if featureCSV_exists %}
          <a href="static/output/{{session_id}}/FeatureVectors.csv?timestamp={{timestamp}}" class="btn btn-info text-center" id="btn-download" download="FeatureVectors.csv" style="bottom: 60px;width: 320px;left: 20px;position: absolute;opacity: 0.7;display:inherit;margin: 15px;">Save Feature Vectors CSV</a>
        {% else %}
          <a href="static/output/{{session_id}}/FeatureVectors.csv?timestamp={{timestamp}}" class="btn btn-info text-center" id="btn-download" download="FeatureVectors.csv" style="bottom: 60px;left: 20px;position: absolute; width: 320px;opacity: 0.7;display:inherit;margin: 15px;" disabled>Save Feature Vectors CSV</a>
        {% endif %}

        <a href="static/output/{{session_id}}/ReducedFeatures.csv?timestamp={{timestamp}}" class="btn btn-info text-center" id="btn-download" download="ReducedFeatures.csv" style="bottom: 60px;width: 320px; position: absolute;right: 20px;opacity: 0.7;display:inherit;margin: 15px;">Save Reduced Features CSV</a>

        <a href="{{plot_name}}?timestamp={{timestamp}}" class="btn btn-warning text-center" id="btn-download" download="{{plot_name_no_dir}}" style="bottom: 0px;left: 20px;position: absolute;right: 20px;opacity: 0.7;display:inherit;margin: 15px;">Save Image</a>

        <!-- <button type="submit" id="btn-download" class="btn btn-success" style="opacity: 0.7; border-width: 0px;>Generate t-SNE</button> -->

        {% else %}

        <div class="col-md-12 rightside" id="instruction" style="visibility: visible;">
          <div class="">
            <h1> Instructions</h1> <br>
            <!-- <h4> Mouse over the instructions!</h4> -->
            <button id="instruction_step1" class="instruction_steps" onmouseover="setVisible_step1()">Step 1: Select the input images that you wish to run the algorithm with</button><br>
            <button id="instruction_step2" class="instruction_steps" onmouseover="setVisible_step2()">Step 2: Add a marker to image sets by selecting the color of the image border</button><br>
            <button id="instruction_step3" class="instruction_steps" onmouseover="setVisible_step3()">Step 3: Upload the images</button><br>
            <button id="instruction_step4" class="instruction_steps" onmouseover="setVisible_step4()">Step 4: Select the display parameters and algorithm parameters</button><br>
            <button id="instruction_step5" class="instruction_steps" onmouseover="setVisible_step5()">Step 5: Generate t-SNE plot and save the generated image!</button><br>
          </div>
        </div>
        {% endif %}
        <div class="page-loader-content" id="loader" style= "visibility: hidden;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);}">
          <div class="icon-loader">
            <svg class="svg-icon-loader"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ei-spinner-icon"></use></svg>
          </div>
          <div class="icon-flower">
            <svg class="svg-icon-flower"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#flower-icon"></use></svg>
          </div>
          <div style="position: absolute;right: -50px;top: 180px;left: 30px;color:#626d70; opacity: .8;">
            <h4>Hold tight!</h4>
          </div>
          <div style="position: absolute;right: -50px;top: 210px;left: -35px;color:#626d70; opacity: .8;">
            <h4 style="top: 40px;">This might take a minute...</h4><h4>
          </h4></div>
        </div>
      </section>
    </section>
  </div>
</div>
<!-- </div> -->
<!-- Footer -->
<div class="row mydivider" style="height:3px; background-color: #1b9eb245;"></div>

<div style="padding: 30px;">
  <div class="row footer" >
    <div class="col-sm-12">
      <a class="footer-link" href="mailto:danielsnider12@gmail.com; bessaFan01@gmail.com" target="_blank">Contact</a>
      <a class="footer-link" href="https://github.com/bessaFan/ML-playground" target="_blank" >Documentation</a>
      <a class="footer-link" onclick="tweet_checkbox()">Support Us</a>
      <div style="position: absolute;right: 0px; top:0px">
        <a href="https://github.com/bessaFan/ML-playground" target="_blank">
          <img style="opacity: 0.7;width:50px;" src="/static/images/github_icon.svg">
        </a>
      </div>
    </div>
  </div>
  <div class="row footer">
    <div class="text-center footer-content" style="color: #6d9498;">Made with ❤ in Toronto</div>
  </div>
</div>
</body>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="static/js/bootstrap.min.js"></script>
<script src="static/node_modules/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js" rel="stylesheet"></script>
